# Copyright (c) 2021 LG Electronics
# SPDX-License-Identifier: Apache-2.0
[tox]
envlist = test_run
skipdist = true

[testenv]
install_command = pip install {opts} {packages}
allowlist_externals = cat
                      cp
                      rm
                      ls
                      pytest

setenv =
  ; TYPECODE_LIBMAGIC_DB_PATH = /usr/share/file/magic.mgc
  PYTHONPATH=.

[flake8]
max-line-length = 130
exclude = .tox/*

[pytest]
filterwarnings = ignore::DeprecationWarning
norecursedirs = test_result_*

[testenv:test_run]
; deps =
;   -r{toxinidir}/requirements.txt
changedir = {tox_root}/tests

commands =
    ; rm -rf test_result_local_path
    ; rm -rf test_result_exclude_path
    ; rm -rf test_result_wget
    ; fosslight -o test_result_local_path/test.xlsx -p tests -r
    ; fosslight binary source -o test_result_multi_mode/test.xlsx -p tests -r
    ; fosslight -o test_result_exclude_path/test.xlsx -p tests -e test sample_license.txt
    ; fosslight dependency -o test_result_wget -w "https://github.com/LGE-OSS/example.git"
    ; fosslight source -s tests/setting.json
    ; ls test_result_wget
    pytest


[testenv:release]
deps =
  -r{toxinidir}/requirements-dev.txt

changedir = {tox_root}/tests

commands =
    ; fosslight -h
    ; fosslight all -o test_result_local_path/test.xlsx -p tests -r
    ; fosslight binary dependency -o test_result_multi_mode/test.xlsx -p tests -r
    ; fosslight -o test_result_exclude_path/test.xlsx -p tests -e test sample_license.txt
    ; fosslight source -o test_result_wget -w "https://github.com/LGE-OSS/example.git"
    ; fosslight binary -s tests/setting.json
    pytest -v --flake8
